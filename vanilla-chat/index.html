<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <title>Chat Client Demo</title>
</head>

<body>
    <div class="p-8 prose">
        <h1>Vanilla Chat Client Demo</h1>

        <div id="output"></div>
    </div>

    <script>
        // Example from https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_a_WebSocket_server_in_JavaScript_Deno
        // run using npx serve ../vanilla-chat

        const wsUri = "ws://127.0.0.1:6969/chat/1231231swda22";
        const output = document.querySelector("#output");
        const websocket = new WebSocket(wsUri);
        let pingInterval;

        function writeToScreen(message) {
            output.insertAdjacentHTML("afterbegin", `<p>${message}</p>`);
        }

        function sendMessage(message) {
            writeToScreen(`SENT: ${message}`);
            websocket.send(message);
        }

        websocket.onopen = (e) => {
            writeToScreen("CONNECTED");
            sendMessage("ping");
            pingInterval = setInterval(() => {
                sendMessage("ping");
            }, 5000);
        };

        websocket.onclose = (e) => {
            writeToScreen("DISCONNECTED");
            clearInterval(pingInterval);
        };

        websocket.onmessage = (e) => {
            writeToScreen(`RECEIVED: ${e.data}`);
        };

        websocket.onerror = (e) => {
            writeToScreen(`ERROR: ${e.data}`);
        };
    </script>
</body>

</html>